<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>iZwi - Community Alerts</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;family=Poppins:wght@500;600&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
.custom-alert-marker {
    background: transparent !important;
    border: none !important;
    animation: pulse-once 0.8s ease-out;
}

@keyframes pulse-once {
    0% {
        transform: scale(0.8);
        opacity: 0.7;
    }
    50% {
        transform: scale(1.1);
        opacity: 1;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.custom-alert-marker:hover {
    transform: scale(1.1);
    transition: transform 0.2s ease;
}
</style>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#264653",
                        "secondary": "#E9C46A",
                        "background": "#F8F9FA",
                        "text-primary": "#264653",
                        "alert-crime": "#E76F51",
                        "alert-utility": "#F4A261",
                        "alert-event": "#2A9D8F",
                        "text-secondary": "#6C757D"
                    },
                    fontFamily: {
                        "display": ["Poppins", "sans-serif"],
                        "body": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.75rem",
                        "lg": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .font-display { font-family: 'Poppins', sans-serif; }
        .font-body { font-family: 'Inter', sans-serif; }
    </style>
<style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
  </head>
<body class="bg-background font-body text-text-primary min-h-screen flex flex-col">
<main class="flex-1 flex flex-col min-h-0">
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="p-4 space-y-3">
      {% for category, message in messages %}
        <div class="alert-message p-4 rounded-lg border-l-4 {% if category == 'success' %}bg-green-50 border-green-400 text-green-700 dark:bg-green-900/20 dark:border-green-500 dark:text-green-300{% elif category == 'error' %}bg-red-50 border-red-400 text-red-700 dark:bg-red-900/20 dark:border-red-500 dark:text-red-300{% else %}bg-blue-50 border-blue-400 text-blue-700 dark:bg-blue-900/20 dark:border-blue-500 dark:text-blue-300{% endif %}" role="alert">
          <div class="flex items-center">
            <span class="mr-2">
              {% if category == 'success' %}✅{% elif category == 'error' %}❌{% else %}ℹ️{% endif %}
            </span>
            <span class="text-sm font-medium">{{ message }}</span>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Main Header with Community Info -->
<header class="bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-6">
  <div class="flex items-center justify-between mb-4">
    <img alt="iZwi Logo" class="h-8 w-auto" src="https://lh3.googleusercontent.com/aida-public/AB6AXuB_pOQD51q3I4utHDxslkN1ZBiEl-4EUWUU_FQqCvGSavCkVmN-lbf04w7_Qh8qmxlpIxQojb1JpWBbWB1eiNFCNbgo9wGtZYgh8ApxzdC9NzEOlxHQUWlFF8metjKlTZAyDzSD4QMrQxzEdtnsbwKGkDUezK7Ll1FoufX6C2r39f4Mjp59oBfDyVtQB7yHBri-X5_zV2ASI6UP7U117eycls3T2YarZGCWiS_EwxzQMbhIKeFZw-2DLoO3ygX6j-W3d_i-i1TEpoU"/>
    <a href="{{ url_for('settings') }}" class="p-2 rounded-full hover:bg-white/10 transition-colors">
      <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
      </svg>
    </a>
  </div>
  
  <!-- Community Information -->
  <div>
    <h1 class="font-display font-bold text-2xl mb-2">{{ community.name }}</h1>
    <div class="flex items-center gap-4 text-white/90">
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-lg">group</span>
        <span class="font-medium">{{ member_count }} {% if member_count == 1 %}member{% else %}members{% endif %}</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-lg">verified</span>
        <span class="font-medium">Active Community</span>
      </div>
    </div>
  </div>
</header>

<div class="flex-1 relative min-h-[250px] sm:min-h-[300px] md:min-h-[400px]">
<div id="map" class="w-full h-full"></div>
</div>
<div class="flex-1 flex flex-col bg-white min-h-[200px] sm:min-h-[250px] md:min-h-[300px]">
<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
<div class="p-4 border-b border-gray-200">
<h2 class="font-display font-bold text-xl text-primary">Recent Alerts</h2>
</div>
<div class="flex-1 overflow-y-auto p-4 space-y-4">
{% for alert in alerts %}
<div class="bg-white rounded-lg border-l-4 shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden" 
     style="border-left-color: {{ get_category_color(alert['category']) }}">
<div class="p-4">
<!-- Alert Header -->
<div class="flex items-start gap-3 mb-3">
<div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl flex-shrink-0" 
     style="background-color: {{ get_category_color(alert['category']) }}">
{{ get_category_icon(alert['category']) }}
</div>
<div class="flex-1 min-w-0">
<div class="flex items-center gap-2 mb-1">
<span class="font-semibold text-gray-900 text-base">{{ alert['category'] }}</span>
<span class="text-xs px-2 py-1 rounded-full text-gray-600 bg-gray-100 font-medium">
{{ format_time_ago(alert['timestamp']) }}
</span>
</div>
<p class="text-sm text-gray-700 leading-relaxed">{{ alert['description'] }}</p>
</div>
</div>

<!-- Alert Footer -->
<div class="flex items-center justify-between pt-2 border-t border-gray-50">
<div class="flex items-center text-xs text-gray-500">
<span class="material-symbols-outlined text-base mr-2">person</span>
<span class="font-medium">{{ alert['author_name'] if alert['author_name'] else 'Anonymous' }}</span>
</div>
<button onclick="reportAlert({{ alert['id'] }})" 
        class="text-xs text-gray-500 hover:text-red-500 px-3 py-1 rounded-md hover:bg-red-50 transition-all duration-200 flex items-center gap-1"
        title="Report inappropriate content">
<span class="material-symbols-outlined text-sm">flag</span>
<span class="font-medium">Report</span>
</button>
</div>
</div>
</div>
{% endfor %}
{% if not alerts %}
<div class="text-center py-8">
<div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center">
<span class="material-symbols-outlined text-2xl text-gray-400">notifications_off</span>
</div>
<p class="text-gray-500">No recent alerts in your community.</p>
<p class="text-sm text-gray-400 mt-1">Post the first alert to get started!</p>
</div>
{% endif %}
</div>
</div>
</main>
<button onclick="showPostAlert()" class="fixed bottom-6 right-6 bg-secondary text-primary h-16 w-16 rounded-full shadow-lg hover:shadow-xl flex items-center justify-center transition-all duration-200 z-50">
<span class="material-symbols-outlined text-2xl font-bold">add_alert</span>
</button>

<!-- Data for JavaScript (hidden JSON) -->
<script type="application/json" id="alerts-data">
[
    {% for alert in alerts %}
    {
        "id": {{ alert['id'] if alert['id'] is not none else 0 }},
        "category": "{{ alert['category'] if alert['category'] else 'Other' }}",
        "description": "{{ (alert['description'] if alert['description'] else 'No description')|e }}",
        "lat": {{ alert['latitude'] if alert['latitude'] is not none else -26.2041 }},
        "lng": {{ alert['longitude'] if alert['longitude'] is not none else 26.889513 }},
        "timestamp": "{{ alert['timestamp'] if alert['timestamp'] else 'Unknown time' }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
]
</script>

<script type="application/json" id="boundary-data">
{% if boundary_data %}{{ boundary_data|safe }}{% else %}null{% endif %}
</script>

<!-- Load dashboard JavaScript -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<footer class="bg-background dark:bg-background-dark/50 py-4 mt-auto">
<div class="container mx-auto text-center text-xs text-text-secondary dark:text-gray-400">
<div class="flex flex-wrap justify-center gap-3 mb-1">
<a href="{{ url_for('privacy_policy') }}" class="hover:text-primary">Privacy Policy</a>
<span>•</span>
<a href="{{ url_for('terms_of_service') }}" class="hover:text-primary">Terms of Service</a>
</div>
© 2024 iZwi. All rights reserved.
</div>
</footer>


</body></html>