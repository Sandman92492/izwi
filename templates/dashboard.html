<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>iZwi - Community Alerts</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;family=Poppins:wght@500;600&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#264653",
                        "secondary": "#E9C46A",
                        "background": "#F8F9FA",
                        "text-primary": "#264653",
                        "alert-crime": "#E76F51",
                        "alert-utility": "#F4A261",
                        "alert-event": "#2A9D8F",
                        "text-secondary": "#6C757D"
                    },
                    fontFamily: {
                        "display": ["Poppins", "sans-serif"],
                        "body": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.75rem",
                        "lg": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .font-display { font-family: 'Poppins', sans-serif; }
        .font-body { font-family: 'Inter', sans-serif; }
    </style>
<style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background font-body text-text-primary">
<div class="flex flex-col h-screen">
<header class="flex items-center justify-between p-4 bg-background-light dark:bg-background-dark shadow-sm">
<img alt="iZwi Logo" class="h-8 w-auto" src="https://lh3.googleusercontent.com/aida-public/AB6AXuB_pOQD51q3I4utHDxslkN1ZBiEl-4EUWUU_FQqCvGSavCkVmN-lbf04w7_Qh8qmxlpIxQojb1JpWBbWB1eiNFCNbgo9wGtZYgh8ApxzdC9NzEOlxHQUWlFF8metjKlTZAyDzSD4QMrQxzEdtnsbwKGkDUezK7Ll1FoufX6C2r39f4Mjp59oBfDyVtQB7yHBri-X5_zV2ASI6UP7U117eycls3T2YarZGCWiS_EwxzQMbhIKeFZw-2DLoO3ygX6j-W3d_i-i1TEpoU"/>
<button class="p-2 rounded-full">
<svg class="h-8 w-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
</header>
<main class="flex-1 flex flex-col overflow-hidden">
<div class="h-1/2 relative">
<div id="map" class="w-full h-full"></div>
</div>
<div class="h-1/2 flex flex-col bg-white">
<div class="p-4 border-b border-gray-200">
<h2 class="font-display font-bold text-xl text-primary">Recent Alerts</h2>
</div>
<div class="flex-1 overflow-y-auto px-4 space-y-4 pt-4 pb-20">
{% for alert in alerts %}
<div class="bg-white rounded-lg shadow-md flex flex-col border border-gray-200">
<div class="p-4 flex-1">
<div class="flex items-start justify-between mb-2">
<div>
<span class="inline-block bg-alert-{{alert[3].lower()}}/10 text-alert-{{alert[3].lower()}} text-xs font-semibold px-2.5 py-1 rounded-full font-body uppercase tracking-wider">{{alert[3]}}</span>
<h3 class="font-display font-bold text-lg text-primary mt-1">{{alert[4]}}</h3>
</div>
<div class="text-right">
<span class="text-sm text-text-secondary font-medium font-body">{{alert[7]}}</span>
</div>
</div>
<p class="font-body text-text-primary dark:text-gray-300 text-sm mb-3">{{alert[4]}}</p>
<div class="flex items-center text-text-secondary text-sm">
<span class="material-symbols-outlined text-base mr-1.5">location_on</span>
<p class="font-body">Lat: {{alert[5]}}, Lng: {{alert[6]}}</p>
</div>
</div>
</div>
{% endfor %}
{% if not alerts %}
<div class="text-center py-8">
<p class="text-text-secondary">No alerts in your community yet.</p>
</div>
{% endif %}
</div>
</div>
</main>
<button onclick="showPostAlert()" class="absolute bottom-6 right-6 bg-secondary text-primary h-16 w-16 rounded-full shadow-lg flex items-center justify-center">
<svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 4v16m8-8H4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
</div>

<script>
// Initialize the map
var map = L.map('map').setView([-26.2041, 28.0473], 13); // Default to Johannesburg

// Add tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
}).addTo(map);

// Alert markers data
var alerts = [
    {% for alert in alerts %}
    {
        id: {{ alert[0] }},
        category: "{{ alert[3] }}",
        description: "{{ alert[4] }}",
        lat: {{ alert[5] if alert[5] else -26.2041 }},
        lng: {{ alert[6] if alert[6] else 28.0473 }},
        timestamp: "{{ alert[7] }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
];

// Add markers for each alert
alerts.forEach(function(alert) {
    var icon = L.divIcon({
        className: 'custom-alert-marker',
        html: '<div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold bg-alert-' + alert.category.toLowerCase() + '">' + 
              getCategoryIcon(alert.category) + '</div>',
        iconSize: [32, 32],
        iconAnchor: [16, 16]
    });
    
    var marker = L.marker([alert.lat, alert.lng], {icon: icon}).addTo(map);
    marker.bindPopup('<div class="p-2"><strong>' + alert.category + '</strong><br>' + 
                     alert.description + '<br><small>' + alert.timestamp + '</small></div>');
});

function getCategoryIcon(category) {
    switch(category.toLowerCase()) {
        case 'emergency': return 'üö®';
        case 'fire': return 'üî•';
        case 'traffic': return 'üöó';
        case 'weather': return '‚õàÔ∏è';
        case 'community': return 'üèòÔ∏è';
        default: return '‚ùó';
    }
}

function showPostAlert() {
    // This will be implemented when we add the post alert modal
    alert('Post Alert functionality - to be implemented');
}
</script>

</body></html>